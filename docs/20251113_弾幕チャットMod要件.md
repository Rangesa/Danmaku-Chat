# 弾幕チャットMod 要件定義書

## プロジェクト概要

**プロジェクト名**: DanmakuChat (弾幕チャット)
**Minecraft バージョン**: 1.21.8
**Mod Loader**: Fabric
**目的**: ニコニコ動画風の弾幕チャットシステムをMinecraftで再現する

---

## 機能要件

### 1. 通常チャットの非表示機能

- Minecraftの標準チャットUIを完全に非表示にする
- チャット履歴は内部的に保持（必要に応じてアクセス可能）
- 設定でオン・オフ切り替え可能とする

### 2. 弾幕チャット表示システム

#### 基本動作
- サーバーから受信したチャットメッセージを画面上部に表示
- メッセージは**右から左**へ流れる（横スクロール）
- 複数のメッセージが同時に流れる際は、上下に段階的に配置
- メッセージの表示時間と速度は調整可能

#### 表示仕様
- 半透明の背景付きテキスト表示
- プレイヤー名とメッセージを区別して表示
- 色付きテキスト対応（Minecraftのフォーマットコード対応）
- 画面外に出たメッセージは自動削除

### 3. ニコニコ動画弾幕アルゴリズムの参考実装

以下のニコニコ動画の特許技術を参考に実装：
- コメント衝突回避アルゴリズム
- 表示レーン管理システム
- 優先度制御（重要なメッセージを目立たせる）
- 流速調整機能

**参考資料**:
- ニコニコ動画特許: [コメント表示システム関連特許](https://patents.google.com/?q=nicovideo&q=comment)
- 実装時は特許に抵触しない範囲で独自実装を行う

### 4. ローカル処理による弾幕表示

#### ゲーム内チャット
- サーバーから送信されたチャットをクライアント側で受信
- 完全にローカルで弾幕としてレンダリング
- ネットワーク遅延の影響を最小化

#### 外部チャット連携（拡張機能）
- Discord等の外部チャットサービスと連携
- Webhook/Bot APIを使用して外部メッセージを取得
- ゲーム内チャットと同じ弾幕システムで表示
- 外部チャット用の色分け・アイコン表示

---

## 技術要件

### クライアント側実装
- Fabric API使用
- Mixinによるチャットレンダリングフック
- カスタムHUDレンダラー実装
- 設定画面（Mod Menu連携）

### パフォーマンス要件
- 大量のメッセージ表示でもFPS低下を最小限に
- 効率的なメッセージキュー管理
- GPUレンダリング最適化

### 拡張性
- 外部チャットプラグインシステム
- カスタムフィルター機能
- テーマ・スキンシステム

---

## 開発フェーズ

### Phase 1: 基礎実装
1. Fabricプロジェクトセットアップ
2. 通常チャット非表示機能
3. 基本的な弾幕レンダリングシステム

### Phase 2: 弾幕システム完成
1. コメント衝突回避アルゴリズム
2. レーン管理システム
3. 表示速度・時間調整機能

### Phase 3: 外部連携
1. Discord連携実装
2. 他の外部チャットサービス対応
3. プラグインシステム構築

### Phase 4: 最適化・UI改善
1. パフォーマンス最適化
2. 設定画面の充実
3. テーマシステム実装

---

## 設定項目（予定）

- 弾幕表示ON/OFF
- 表示速度調整（遅い・普通・速い）
- 表示時間調整（秒数）
- 最大表示レーン数
- フォントサイズ
- 背景透明度
- 外部チャット連携ON/OFF
- フィルター設定（NGワード等）

---

## 参考資料・技術文献

- [Fabric Wiki](https://fabricmc.net/wiki/)
- [Minecraft Rendering](https://fabricmc.net/wiki/tutorial:rendering)
- [ニコニコ動画コメントシステム技術解説](https://dwango.github.io/nicolive-comment-viewer/)
- Discord API Documentation

---

**作成日**: 2025-11-13
**最終更新**: 2025-11-13
